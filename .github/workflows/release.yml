name: ğŸš€ Release NuGet Package

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write
  packages: read  # solo lectura, no publica

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Clonar el repositorio
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4

      # 2ï¸âƒ£ Configurar .NET
      - name: âš™ï¸ Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '9.0.x'

      # 3ï¸âƒ£ Restaurar dependencias
      - name: ğŸ“¦ Restore dependencies
        run: dotnet restore

      # 4ï¸âƒ£ Compilar el proyecto en modo Release
      - name: ğŸ—ï¸ Build project
        run: dotnet build --configuration Release

      # 5ï¸âƒ£ Empaquetar el proyecto con tu cÃ³digo de matrÃ­cula como versiÃ³n
      - name: ğŸ“¦ Create NuGet package nuget
        run: |
          dotnet pack --configuration Release \
            -p:PackageVersion=2019065161 \
            -p:Authors="UPT - Calidad y Pruebas de Software" \
            -p:RepositoryUrl=https://github.com/${{ github.repository }} \
            -o ./nupkg
          echo "âœ… Paquete NuGet generado en ./nupkg"

      # 6ï¸âƒ£ Subir el paquete como artefacto (en lugar de publicarlo)
      - name: ğŸ“¦ Upload .nupkg artifact
        uses: actions/upload-artifact@v4
        with:
          name: NuGetPackage
          path: ./nupkg/*.nupkg

      # 7ï¸âƒ£ Crear el release correspondiente
      - name: ğŸ·ï¸ Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v2019065161
          name: "Release v2019065161"
          body: |
            ğŸ‰ **Release automÃ¡tico generado desde GitHub Actions**
            - VersiÃ³n: 2019065161  
            - Generado por el flujo de trabajo `release.yml`  
            - ğŸ“¦ El paquete se adjunta como artefacto en esta ejecuciÃ³n.
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
